import{d as w,m as k,n as R,c as q,r as x,u as A,a as F,b as M,w as U,e as z,f as l,p as G,g as I,h as Y,i as j,j as J,o as O,k as V,l as v,q as f,s as b,t as C,F as X,v as K,x as Q,y as W}from"./index-DRKJTREC.js";import{C as Z,T as ee,s as te}from"./index-BGA7Jz_8.js";import{L as E,C as se}from"./index-CI2nGlxE.js";import{b as P}from"./route-block-B_A1xBdJ.js";const[ae,_,ne]=q("pull-refresh"),L=50,oe=["pulling","loosing","success"],le={disabled:Boolean,modelValue:Boolean,headHeight:k(L),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:R,successDuration:k(500),animationDuration:k(300)};var ue=w({name:ae,props:le,emits:["change","refresh","update:modelValue"],setup(s,{emit:d,slots:n}){let c;const T=x(),h=x(),u=A(T),t=F({status:"normal",distance:0,duration:0}),r=M(),p=()=>{if(s.headHeight!==L)return{height:"".concat(s.headHeight,"px")}},m=()=>t.status!=="loading"&&t.status!=="success"&&!s.disabled,y=e=>{const a=+(s.pullDistance||s.headHeight);return e>a&&(e<a*2?e=a+(e-a)/2:e=a*1.5+(e-a*2)/4),Math.round(e)},i=(e,a)=>{const g=+(s.pullDistance||s.headHeight);t.distance=e,a?t.status="loading":e===0?t.status="normal":e<g?t.status="pulling":t.status="loosing",d("change",{status:t.status,distance:e})},o=()=>{const{status:e}=t;return e==="normal"?"":s["".concat(e,"Text")]||ne(e)},S=()=>{const{status:e,distance:a}=t;if(n[e])return n[e]({distance:a});const g=[];return oe.includes(e)&&g.push(l("div",{class:_("text")},[o()])),e==="loading"&&g.push(l(E,{class:_("loading")},{default:o})),g},N=()=>{t.status="success",setTimeout(()=>{i(0)},+s.successDuration)},D=e=>{c=Y(u.value)===0,c&&(t.duration=0,r.start(e))},$=e=>{m()&&D(e)},B=e=>{if(m()){c||D(e);const{deltaY:a}=r;r.move(e),c&&a.value>=0&&r.isVertical()&&(G(e),i(y(a.value)))}},H=()=>{c&&r.deltaY.value&&m()&&(t.duration=+s.animationDuration,t.status==="loosing"?(i(+s.headHeight,!0),d("update:modelValue",!0),I(()=>d("refresh"))):i(0))};return U(()=>s.modelValue,e=>{t.duration=+s.animationDuration,e?i(+s.headHeight,!0):n.success||s.successText?N():i(0,!1)}),z("touchmove",B,{target:h}),()=>{var e;const a={transitionDuration:"".concat(t.duration,"ms"),transform:t.distance?"translate3d(0,".concat(t.distance,"px, 0)"):""};return l("div",{ref:T,class:_()},[l("div",{ref:h,class:_("track"),style:a,onTouchstartPassive:$,onTouchend:H,onTouchcancel:H},[l("div",{class:_("head"),style:p()},[S()]),(e=n.default)==null?void 0:e.call(n)])])}}});const ie=j(ue),ce={class:"device-list"},re=w({__name:"index",setup(s){const d=x([]),n=x(!1),c=J();function T(u){c.push({path:"/control",query:{device:JSON.stringify(u)}})}async function h(){n.value=!0;try{const u=await W.get("/userPool");d.value=u}catch(u){te("获取设备列表失败"),console.error("获取设备列表失败:",u)}finally{n.value=!1}}return O(()=>{h()}),(u,t)=>{const r=E,p=se,m=ee,y=Z,i=ie;return v(),V("div",ce,[l(i,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),onRefresh:h},{default:f(()=>[l(y,{inset:!0},{default:f(()=>[n.value?(v(),b(p,{key:0,center:""},{title:f(()=>[l(r,{type:"spinner",size:"24px"},{default:f(()=>t[1]||(t[1]=[C(" 加载中... ")])),_:1,__:[1]})]),_:1})):(v(!0),V(X,{key:1},K(d.value,o=>(v(),b(p,{key:o.imei,title:o.imei,label:"No: ".concat(o.phone||"未设置"),"is-link":"",onClick:S=>T(o)},{"right-icon":f(()=>[l(m,{type:o.connected?"success":"danger",size:"medium"},{default:f(()=>[C(Q(o.connected?"在线":"离线"),1)]),_:2},1032,["type"])]),_:2},1032,["title","label","onClick"]))),128))]),_:1})]),_:1},8,["modelValue"])])}}});typeof P=="function"&&P(re);export{re as default};
