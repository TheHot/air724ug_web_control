import{d as I,N as A,c as O,r as C,a3 as G,Q,f as t,i as $,a4 as L,a5 as Y,a6 as j,V as x,R as J,a7 as W,a as X,a8 as Z,$ as ee,a9 as ne,D as te,P as oe,aa as ae,M as le,B as se,n as re,ab as F,ac as ie,ad as ce,ae as ue,af as de,ag as fe,k as me,l as ge,q as w,a2 as T,x as D,z as N,ah as V,A as Be}from"./index-f35fkoae.js";import{C as ve}from"./index-dYdQ2Z2E.js";import{B as U,F as he}from"./index-lP0G9hj6.js";import{C as we,s as b}from"./index-Bf3vEwwm.js";import{u as be}from"./user-GSuQUqXr.js";import{b as K}from"./route-block-B_A1xBdJ.js";const[z,q]=O("action-bar"),M=Symbol(z),Ce={placeholder:Boolean,safeAreaInsetBottom:A};var ye=I({name:z,props:Ce,setup(e,{slots:u}){const o=C(),r=G(o,q),{linkChildren:i}=Q(M);i();const f=()=>{var d;return t("div",{ref:o,class:[q(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(d=u.default)==null?void 0:d.call(u)])};return()=>e.placeholder?r(f):f()}});const pe=$(ye),[ke,Pe]=O("action-bar-button"),xe=L({},W,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var _e=I({name:ke,props:xe,setup(e,{slots:u}){const o=Y(),{parent:r,index:i}=j(M),f=x(()=>{if(r){const a=r.children[i.value-1];return!(a&&"isButton"in a)}}),d=x(()=>{if(r){const a=r.children[i.value+1];return!(a&&"isButton"in a)}});return J({isButton:!0}),()=>{const{type:a,icon:m,text:v,color:y,loading:p,disabled:k}=e;return t(U,{class:Pe([a,{last:d.value,first:f.value}]),size:"large",type:a,icon:m,color:y,loading:p,disabled:k,onClick:o},{default:()=>[u.default?u.default():v]})}}});const H=$(_e),[Se,B,E]=O("dialog"),Te=L({},ae,{title:String,theme:String,width:re,message:[String,Function],callback:Function,allowHtml:Boolean,className:se,transition:le("van-dialog-bounce"),messageAlign:String,closeOnPopstate:A,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:A,closeOnClickOverlay:Boolean,keyboardEnabled:A,destroyOnClose:Boolean}),De=[...ce,"transition","closeOnPopstate","destroyOnClose"];var Ve=I({name:Se,props:Te,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:u,slots:o}){const r=C(),i=X({confirm:!1,cancel:!1}),f=n=>u("update:show",n),d=n=>{var s;f(!1),(s=e.callback)==null||s.call(e,n)},a=n=>()=>{e.show&&(u(n),e.beforeClose?(i[n]=!0,ie(e.beforeClose,{args:[n],done(){d(n),i[n]=!1},canceled(){i[n]=!1}})):d(n))},m=a("cancel"),v=a("confirm"),y=Z(n=>{var s,l;if(!e.keyboardEnabled||n.target!==((l=(s=r.value)==null?void 0:s.popupRef)==null?void 0:l.value))return;({Enter:e.showConfirmButton?v:F,Escape:e.showCancelButton?m:F})[n.key](),u("keydown",n)},["enter","esc"]),p=()=>{const n=o.title?o.title():e.title;if(n)return t("div",{class:B("header",{isolated:!e.message&&!o.default})},[n])},k=n=>{const{message:s,allowHtml:l,messageAlign:h}=e,S=B("message",{"has-title":n,[h]:h}),R=ue(s)?s():s;return l&&typeof R=="string"?t("div",{class:S,innerHTML:R},null):t("div",{class:S},[R])},g=()=>{if(o.default)return t("div",{class:B("content")},[o.default()]);const{title:n,message:s,allowHtml:l}=e;if(s){const h=!!(n||o.title);return t("div",{key:l?1:0,class:B("content",{isolated:!h})},[k(h)])}},c=()=>t("div",{class:[fe,B("footer")]},[e.showCancelButton&&t(U,{size:"large",text:e.cancelButtonText||E("cancel"),class:B("cancel"),style:{color:e.cancelButtonColor},loading:i.cancel,disabled:e.cancelButtonDisabled,onClick:m},null),e.showConfirmButton&&t(U,{size:"large",text:e.confirmButtonText||E("confirm"),class:[B("confirm"),{[de]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:i.confirm,disabled:e.confirmButtonDisabled,onClick:v},null)]),P=()=>t(pe,{class:B("footer")},{default:()=>[e.showCancelButton&&t(H,{type:"warning",text:e.cancelButtonText||E("cancel"),class:B("cancel"),color:e.cancelButtonColor,loading:i.cancel,disabled:e.cancelButtonDisabled,onClick:m},null),e.showConfirmButton&&t(H,{type:"danger",text:e.confirmButtonText||E("confirm"),class:B("confirm"),color:e.confirmButtonColor,loading:i.confirm,disabled:e.confirmButtonDisabled,onClick:v},null)]}),_=()=>o.footer?o.footer():e.theme==="round-button"?P():c();return()=>{const{width:n,title:s,theme:l,message:h,className:S}=e;return t(oe,ee({ref:r,role:"dialog",class:[B([l]),S],style:{width:te(n)},tabindex:0,"aria-labelledby":s||h,onKeydown:y,"onUpdate:show":f},ne(e,De)),{default:()=>[p(),g(),_()]})}}});const Ee=$(Ve),Ae=I({__name:"index",setup(e){const u=be(),o=x(()=>u.userInfo),r=x(()=>!!o.value.name),i=x(()=>"生活不止眼前的苟且，还有诗和远方的田野"),f=C(!1),d=C(""),a=C(""),m=C("");function v(){r.value||V.push({name:"login",query:{redirect:"profile"}})}function y(){if(!r.value){v();return}d.value="",a.value=o.value.name||"",m.value="",f.value=!0}async function p(){if(!d.value||!a.value||!m.value){b("请填写完整信息");return}try{const g=await Be.post("/change-user-info",{oldPassword:d.value,newUsername:a.value,newPassword:m.value});u.userInfo.name=g.username,b(g.message||"用户信息修改成功"),f.value=!1,g.needRelogin&&(b("用户信息已修改，请重新登录"),V.push({name:"login",query:{redirect:V.currentRoute.value.fullPath}}))}catch(g){b("请求失败，请稍后再试"),console.error(g)}}async function k(){try{await u.logout(),b("注销成功"),V.push({name:"login"})}catch(g){b("注销失败，请稍后再试"),console.error(g)}}return(g,c)=>{const P=ve,_=we,n=he,s=Ee;return ge(),me("div",null,[t(_,{inset:!0},{default:w(()=>[t(P,{center:"","is-link":!T(r),onClick:v},{title:w(()=>[D("span",null,N(T(r)?"".concat(T(o).name):g.$t("profile.login")),1)]),label:w(()=>[D("span",null,N(T(i)),1)]),_:1},8,["is-link"])]),_:1}),t(_,{inset:!0,class:"!mt-16"},{default:w(()=>[t(P,{title:"修改用户信息",icon:"setting-o","is-link":"",onClick:y},{icon:w(()=>c[4]||(c[4]=[D("div",{class:"i-carbon:settings text-gray-400 mr-5 self-center"},null,-1)])),_:1}),t(P,{title:"注销登录","is-link":"",onClick:k},{icon:w(()=>c[5]||(c[5]=[D("div",{class:"i-carbon:logout text-gray-400 mr-5 self-center"},null,-1)])),_:1})]),_:1}),t(s,{show:f.value,"onUpdate:show":c[3]||(c[3]=l=>f.value=l),title:"修改用户信息","show-cancel-button":"",onConfirm:p},{default:w(()=>[t(n,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=l=>a.value=l),label:"用户名",placeholder:"请输入新用户名"},null,8,["modelValue"]),t(n,{modelValue:d.value,"onUpdate:modelValue":c[1]||(c[1]=l=>d.value=l),label:"旧密码",placeholder:"请输入旧密码",type:"password"},null,8,["modelValue"]),t(n,{modelValue:m.value,"onUpdate:modelValue":c[2]||(c[2]=l=>m.value=l),label:"新密码",placeholder:"请输入新密码",type:"password"},null,8,["modelValue"])]),_:1},8,["show"])])}}});typeof K=="function"&&K(Ae);export{Ae as default};
